require "rake/clean"

CLEAN << "files"

file "files" do
    mkdir "files"
    mkdir "files/yamls"
    mkdir "files/stats"
    mkdir "files/details"
    mkdir "files/solutions"
    mkdir "files/results"
end

def inspector name, output
    unless File.exists? output then
        ruby "-Ilib inspect/topcoder/#{name}_inspect.rb"  
    end
end

def tester name
    ruby "-Ilib test/topcoder/#{name}_test.rb"    
end

namespace :inspect do
    desc "Inspect the downloader"
    task :download => "files" do 
        inspector "download", "files/stats/Checker.htm"
    end

    desc "Inspect the parser"
    task :parse => "inspect:download" do 
        inspector "parse", "files/yamls/Checker.yml"
    end

    desc "Inspect the generator"
    task :generate => "inspect:parse" do 
        inspector "generate", "files/results/BuildingRoads"
    end
end

namespace :test do
    desc "Test the downloader"
    task :download do 
        tester "download"
    end

    desc "Test the parser"
    task :parse => "inspect:download" do 
        tester "parse" 
    end

    desc "Test the generator"
    task :generate do 
        tester "generate" 
    end

    desc "Test everything"
    task :all => %w[test:download test:parse test:generate] do
    end
end